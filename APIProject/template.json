{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Transform": "AWS::Serverless-2016-10-31",
    "Parameters": {
        "AppName": {
            "Type": "String",
            "Default": "SWGoH-Api"
        }
    },
    "Globals": {
        "Api": {
            "Cors": {
                "AllowMethods": "'GET,PUT,POST,DELETE,OPTIONS'",
                "AllowHeaders": "'Content-Type,Authorization'",
                "AllowOrigin": "'*'"
            }
        },
        "Function": {
            "Runtime": "nodejs14.x",
            "Handler": "index.handler"
        }
    },
    "Resources": {
        "ApiGateway": {
            "Type": "AWS::Serverless::Api",
            "Properties": {
                "Name": { "Ref": "AppName" },
                "StageName": "SWGoH",
                "EndpointConfiguration": "REGIONAL"
            }
        },
        "UserDetailsLF": {
            "Type": "AWS::Serverless::Function",
            "Properties": {
                "FunctionName": {
                    "Fn::Join": [
                        "-",
                        [
                            { "Ref": "AppName" },
                            "UserDetails-LF"
                        ]
                    ]
                },
                "CodeUri": "./LambdaFunctions/UserDetails-LF",
                "Events": {
                    "PlayerData": {
                        "Type": "Api",
                        "Properties": {
                            "Path": "/Players/",
                            "Method": "get",
                            "RestApiId": {
                                "Ref": "ApiGateway"
                            }
                        }
                    }
                }
            }
        },
        "SignInUser": {
            "Type": "AWS::Serverless::Function",
            "Properties": {
                "FunctionName": {
                    "Fn::Join": [
                        "-",
                        [
                            { "Ref": "AppName" },
                            "SignInUser"
                        ]
                    ]
                },
                "CodeUri": "./LambdaFunctions/SignInUser",
                "Timeout": 9,
                "Layers": [
                    {
                        "Ref": "AssetLayer"
                    }
                ],
                "Events": {
                    "SignIn": {
                        "Type": "Api",
                        "Properties": {
                            "Path": "/SignIn/",
                            "Method": "post",
                            "RestApiId": {
                                "Ref": "ApiGateway"
                            }
                        }
                    }
                }
            }
        },
        "GuildData": {
            "Type": "AWS::Serverless::Function",
            "Properties": {
                "FunctionName": {
                    "Fn::Join": [
                        "-",
                        [
                            { "Ref": "AppName" },
                            "GuildData"
                        ]
                    ]
                },
                "CodeUri": "./LambdaFunctions/GuildData",
                "Timeout": 30,
                "Layers": [
                    {
                        "Ref": "AssetLayer"
                    }
                ],
                "Events": {
                    "GetGuildData": {
                        "Type": "Api",
                        "Properties": {
                            "Path": "/GuildData/{proxy+}",
                            "Method": "get",
                            "RestApiId": {
                                "Ref": "ApiGateway"
                            }
                        }
                    },
                    "GuildData": {
                        "Type": "Api",
                        "Properties": {
                            "Path": "/GuildData/",
                            "Method": "post",
                            "RestApiId": {
                                "Ref": "ApiGateway"
                            }
                        }
                    }
                }
            }
        },
        "AssetLayer": {
            "Type": "AWS::Serverless::LayerVersion",
            "Properties": {
                "LayerName": {
                    "Fn::Join": [
                        "-",
                        [
                            { "Ref": "AppName" },
                            "SignInUser"
                        ]
                    ]
                },
                "ContentUri": "./LambdaFunctions/AssetLayer",
                "CompatibleRuntimes": [ "nodejs14.x" ],
                "RetentionPolicy": "Retain"
            },
            "Metadata": {
                "BuildMethod": "nodejs14.x"
            }
        }
    }
}
